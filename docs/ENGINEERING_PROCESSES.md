# Engineering Processes

## Testing

Where possible, we prefer that code is tested. For Python, we use `pytest` for testing like so:

```bash
python -m pytest
```

You can learn more about the `-m` flag
[here](https://docs.python.org/3/using/cmdline.html#cmdoption-m).

## Coding Style

To aid code readability, we prefer to use Google coding style. Please familiarize yourself Google's
Python style guide [here](http://google.github.io/styleguide/pyguide.html).

Where possible, we also use auto-formatters and linters to enforce code readability. For Python,
we use `yapf` and `flake8`. These tools can be used like so:

```bash
# Run our linter, learn more: https://en.wikipedia.org/wiki/Lint_(software)
flake8 src/; flake8 tests/;

# Automatically format your code.
yapf src/ tests/ --recursive --in-place;
```

You'll want to integrate `yapf` and `flake8` into your code editor, both of these tools are
popular and there are many extensions written for them.

## Repository Layout

To aid code readability, we aim to keep similar pieces of software together. Learn more about
the current layout below.

```BASH
.
├── /.tts_cache/                        # Default location for any other disk caches.
├── /.vscode/                           # Visual studio code configuration.
├── /data/                              # Default location for caching datasets.
├── /experiments/                       # Default location for storing training runs.
├── /docker/                            # Dockerfiles specified for this repository.
                                        # TODO: The Dockerfile are only used in the context of
                                        # the ``service``, consider moving them there.
├── /docs/                              # Additional documentation.
├── /node_modules/                      # Default location for storing npm packages.
├── /notebooks/                         # Experimental and unmaintained jupyter scratch work.
├── /samples/                           # Default location for samples generated by `evaluate.py`.
├── /src/                               # Source code.
│   ├── /bin/                           # Executable scripts.
│   │   ├── /gcp/                       # Executable GCP utility scripts.
│   │   ├── /train/                     # Executable model training scripts.
│   │   ├── /chunk_wav_and_text.py      # Executable that creates a text-to-speech dataset.
│   │   ├── /combine_csv.py             # Executable to combine two CSV files.
│   │   ├── /evaluate.py                # Executable to evaluate model performance.
│   ├── /datasets/                      # Dataset hooks, schema definitions, and processing
                                        # modules.
│   │   ├── /constants.py               # Dataset schema definitions.
│   │   ├── /hilary.py                  # Hilary dataset.
│   │   ├── /lj_speech.py               # Linda Johnson dataset.
│   │   ├── /m_ailabs.py                # M-AILABS dataset.
│   │   └── /process.py                 # Batch dataset processing modules.
│   ├── /hparams/                       # Global optional parameter configuration.
                                        # TODO: Consider setting 'experiments/' and 'data/' folder
                                        # via hparams.
                                        # TODO: Consider renaming to 'defaults'.
│   │   ├── /configurable_.py           # Module for applying configuration.
│   │   └── /configure.py               # Global optional parameter configuration.
│   ├── /service/                       # TTS service deployment.
│   ├── /signal_model/                  # PyTorch signal model module.
│   ├── /spectrogram_model/             # PyTorch spectrogram model module.
│   ├── /utils/                         # Other utilities.
│   ├── /audio.py                       # Audio processing modules.
│   ├── /distributed.py                 # PyTorch distributed training utilities.
│   ├── /environment.py                 # Utilities for setting up the environment.
│   ├── /optimizers.py                  # PyTorch gradient descent optimizer definitions.
│   └── /visualize.py                   # Utilities for constructing visualizations.
├── /tests/                             # Tests executed by PyTest.
├── /third_party/                       # Third party modules not handled by a package manager.
├── /travis/                            # Continuous integration testing scripts.
└── /venv/                              # Default location for Python's virtual environment.
```
